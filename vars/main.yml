cycloid_scheduler_base_env:
    CONCOURSE_SESSION_SIGNING_KEY: "/opt/concourse/{{ concourse_session_signing_key_path }}"
    CONCOURSE_TSA_HOST_KEY: "/opt/concourse/{{ concourse_host_key_path }}"
    CONCOURSE_TSA_AUTHORIZED_KEYS: "/opt/concourse/{{ concourse_authorized_worker_keys_path }}"
    CONCOURSE_MAIN_TEAM_LOCAL_USER: "{{ concourse_auth_user }}"
    CONCOURSE_TSA_TEAM_AUTHORIZED_KEYS_FILE: "/opt/concourse/{{ concourse_team_authorized_worker_keys_path }}"
    CONCOURSE_ADD_LOCAL_USER: "{{ concourse_auth_user }}:{{ concourse_auth_password }}"
    # Vault integration
    CONCOURSE_VAULT_URL: "{{ vault_url }}"
    CONCOURSE_VAULT_AUTH_BACKEND: approle
    CONCOURSE_VAULT_PATH_PREFIX: /cycloid
    CONCOURSE_TLS_CERT: /opt/concourse/ssl.crt
    CONCOURSE_TLS_KEY: /opt/concourse/ssl.key
    CONCOURSE_TLS_BIND_PORT: "{{ concourse_port }}"
    CONCOURSE_VAULT_INSECURE_SKIP_VERIFY: true
    # Defined in vault
    #CONCOURSE_VAULT_APPROLE_SECRET_ID: "VAULT SECRET IDs"
    #CONCOURSE_VAULT_APPROLE_ROLE_ID: "VAULT APPROLE ID"
    #CONCOURSE_VAULT_AUTH_PARAM: "role_id:$(CONCOURSE_VAULT_APPROLE_ROLE_ID),secret_id:$(CONCOURSE_VAULT_APPROLE_SECRET_ID)"
    CONCOURSE_DEFAULT_BUILD_LOGS_TO_RETAIN: "10"
    CONCOURSE_MAX_BUILD_LOGS_TO_RETAIN: "10"
    CONCOURSE_OLD_RESOURCE_GRACE_PERIOD: 5m
    CONCOURSE_RESOURCE_CACHE_CLEANUP_INTERVAL: 30s
    CONCOURSE_PEER_ADDRESS: "{{ concourse_peer_address }}"
    CONCOURSE_EXTERNAL_URL: "{{ concourse_external_url }}"
    CONCOURSE_POSTGRES_HOST: "{{ concourse_db_host }}"
    CONCOURSE_POSTGRES_PORT: "{{ concourse_db_port }}"
    CONCOURSE_POSTGRES_USER: "{{concourse_db_user}}"
    CONCOURSE_POSTGRES_DATABASE: "{{concourse_db_name}}"
    CONCOURSE_POSTGRES_SSLMODE: "{{concourse_db_sslmode}}"
    CONCOURSE_POSTGRES_PASSWORD: "{{concourse_db_password}}"
    CONCOURSE_LOG_LEVEL: "{{concourse_log_level}}"
    CONCOURSE_TSA_LOG_LEVEL: "{{concourse_log_level}}"
    # Require ansible > 2.10 uncomment this and the following cycloid_scheduler_env when we will remove ansible 2.10/10.1 compat
    #CONCOURSE_ENCRYPTION_KEY: "{{ concourse_encryption_key | default(omit, true) }}"
    #CONCOURSE_OLD_ENCRYPTION_KEY: "{{ concourse_old_encryption_key | default(omit, true) }}"
    http_proxy: "{{ http_proxy }}"
    https_proxy: "{{ http_proxy }}"
    no_proxy: "{{ no_proxy }}"

# Require ansible > 2.10 uncomment this and the following cycloid_scheduler_env when we will remove ansible 2.10/10.1 compat
#cycloid_scheduler_env: "{{ cycloid_scheduler_base_env | combine(cycloid_scheduler_extra_env) }}"
cycloid_scheduler_env: "{{ cycloid_scheduler_base_env | combine(cycloid_scheduler_extra_env) | combine({'CONCOURSE_ENCRYPTION_KEY': concourse_encryption_key} if concourse_encryption_key is defined and concourse_encryption_key != '' else {}) | combine({'CONCOURSE_OLD_ENCRYPTION_KEY': concourse_old_encryption_key} if concourse_old_encryption_key is defined and concourse_old_encryption_key != '' else {}) }}"

