---
- block:
    - include: pre-setup.yml

    - include: gen-ssl.yml
      # when: not validate_only and setup_cycloid_core

    - include: cycloid-creds.yml
      when: setup_cycloid_creds

    - include: cycloid-db.yml
      when: setup_cycloid_db

    - include: smtp.yml
      when: setup_smtp_server

    - include: cycloid-cache.yml
      when: setup_cycloid_cache

    - include: cycloid-scheduler-db.yml
      when: setup_cycloid_scheduler_db

    - include: cycloid-scheduler.yml
      when: setup_cycloid_scheduler

    - include: cycloid-api.yml
      when: setup_cycloid_core
    - include: cycloid-frontend.yml
      when: setup_cycloid_core
    - include: nginx.yml
      when: setup_cycloid_core

    #- include: prometheus.yml

    - include: minio.yml
      when: setup_minio

  when: not uninstall and not validate_only

# Wait and validate running services
- include: validate.yml
  when: (validate or validate_only) and not uninstall

- block:
    - include: cycloid-creds_uninstall.yml
      when: setup_cycloid_creds

    - include: cycloid-db_uninstall.yml
      when: setup_cycloid_db

    - include: smtp_uninstall.yml
      when: setup_smtp_server

    - include: cycloid-cache_uninstall.yml
      when: setup_cycloid_cache

    - include: cycloid-scheduler-db_uninstall.yml
      when: setup_cycloid_scheduler_db

    - include: cycloid-scheduler_uninstall.yml
      when: setup_cycloid_scheduler

    - include: cycloid-core_uninstall.yml
      when: setup_cycloid_core

    - include: minio_uninstall.yml
      when: setup_minio
  when: uninstall
