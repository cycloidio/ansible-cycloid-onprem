---

validate: True
validate_only: False
docker_pull: true
#docker_pull: false

setup_cycloid_core: "{{ 'cycloid-core' in group_names }}"
setup_cycloid_scheduler: "{{ 'cycloid-scheduler' in group_names }}"
setup_cycloid_db: "{{ 'cycloid-db' in group_names }}"
setup_cycloid_redis: "{{ 'cycloid-redis' in group_names }}"
setup_scheduler_db: "{{ 'cycloid-scheduler-db' in group_names }}"
setup_cycloid_creds: "{{ 'cycloid-creds' in group_names }}"
#. setup_minio(optional): bool
#+ install and configure minio, a s3-like remote storage
setup_minio: "{{ 'minio' in group_names }}"
# If you let cycloid-smtp:1025, it will start a mailhog smtpd server to satisfy Cycloid requirements
setup_smtp_server: "{{ 'smtp-server' in group_names }}"


cycloid_install_path: /opt/cycloid
cycloid_local_datas_path: "{{ playbook_dir }}/datas"

#
# SSL
#
ssl_generate_selfsigned: true
cycloid_scheduler_ssl:
  crt: "{{ cycloid_local_datas_path }}/ssl/cycloid-scheduler.crt"
  key: "{{ cycloid_local_datas_path }}/ssl/cycloid-scheduler.key"
cycloid_creds_ssl:
  crt: "{{ cycloid_local_datas_path }}/ssl/cycloid-creds.crt"
  key: "{{ cycloid_local_datas_path }}/ssl/cycloid-creds.key"
cycloid_core_ssl:
  crt: "{{ cycloid_local_datas_path }}/ssl/cycloid-core.crt"
  key: "{{ cycloid_local_datas_path }}/ssl/cycloid-core.key"



# HTTP proxy
http_proxy: ""
https_proxy: ""
no_proxy: "localhost,127.0.0.1,concourse-web,vault,{{ cycloid_api_dns }},{{ cycloid_console_dns }}"

#
# Docker
#

cycloid_frontend_image: 661913936052.dkr.ecr.eu-west-1.amazonaws.com/youdeploy-frontend:prod
cycloid_api_image: 661913936052.dkr.ecr.eu-west-1.amazonaws.com/youdeploy-http-api:prod
#cycloid_api_image: gaell/debug
concourse_db_image: postgres:9.6
cycloid_redis_image: redis:5.0
cycloid_db_image: mariadb:10.2.11
concourse_web_image: concourse/concourse:5.7.2
vault_image: vault:1.1.3

#
# Concourse
#
concourse_url: "https://{{ hostvars[groups['cycloid-scheduler'][0]]['ansible_default_ipv4']['address'] }}"
concourse_port: 8443
# concourse_peer_address: must be specified IP used to reach the individual web node, from other web nodes.
concourse_peer_address: "{{ ansible_default_ipv4.address }}"
concourse_external_url: "{{ concourse_url }}:{{ concourse_port }}"
concourse_config_path: "{{ cycloid_install_path }}/concourse"
concourse_db_path: "{{ cycloid_install_path }}/concourse-db"
cycloid_smtp_path: "{{ cycloid_install_path }}/cycloid-smtp"
cycloid_redis_path: "{{ cycloid_install_path }}/cycloid-redis"
concourse_authorized_worker_keys_path: "authorized_worker_keys"
concourse_host_key_path: "host_key"
concourse_session_signing_key_path: "session_signing_key"
concourse_db_password: "Deraephoh9aay4Aide4phoS7xej1xi5m"
concourse_db_host:  "{{ hostvars[groups['cycloid-scheduler-db'][0]]['ansible_default_ipv4']['address'] }}"
concourse_auth_user: admin
concourse_auth_password: admin

#concourse_session_signing_key:
#concourse_host_key:
#concourse_authorized_worker_keys:
#  - name: foo
#    key: ssh-rsa ...

#
# Vault
#
vault_config_path: "{{ cycloid_install_path }}/vault"
vault_config:
  storage:
    file:
       path: /vault/file
  ui: true
  listener:
    tcp:
      address: "0.0.0.0:8200"
      tls_disable: "0"
      tls_cert_file: "/vault/config/ssl.crt"
      tls_key_file:  "/vault/config/ssl.key"
  default_lease_ttl: "168h"
  max_lease_ttl: "720h"
# External vault url used by others services
vault_url: https://{{ hostvars[groups['cycloid-creds'][0]]['ansible_default_ipv4']['address'] }}:8200

#
# Cycloid
#

cycloid_initial_user:
  username: "admin"
  email: "disabled@no-email.cycloid"
  password: "Ch4ngm3pls"
  given_name: admin
  family_name: cycloid

cycloid_initial_organization:
    name: Cycloid
    canonical: cycloid

cycloid_initial_catalog_cred:
    name: Catalog credential
    type: ssh
    path: ssh_catalog
    raw:
        # use a dummy ssh key by default to provide a valid SSH private key format
        ssh_key: |-
            -----BEGIN RSA PRIVATE KEY-----
            MIIEogIBAAKCAQEAwiZDni/2CKWH63bOksu35Ds0/PvJsxmdP1QXqZdL3AThSwqQ
            OoUBp1xGGiGbHmRlDJ91i1OWGMF7AZMIqqqe9jFegpAo2BqxyZONCMWkAIG4Scp4
            33+dorjOUEyXYMAnbmd9sCqMikS7m5XA1v8VXKc6rUCHPQ7dhgW5i26+ZEH6hSrd
            1WfJ4n3dPvbYK4gv/xkASuG84wMfPDMeIPyj4IOgdENpVmmjt+0WHSf1sdRNvzsE
            U1igI2MRqWvVoAZNN9Egj9sYKSplYviIJhkmoNMhMpe4v922Uk/OtY5rJ0meUD5Q
            +dNjyR56f+aumCXIYmigQtW7cJbqbd+yPQcAlwIDAQABAoIBAFZd80KRj191U6uZ
            pHeFDH8JH59S2v1DbcJYRFZ7KZHs0dQyFMsTlBLBZ6YEQR8aBiHBZebe/ixxFakz
            oW1ajXBzsdlfC+xmo6RKcTjvwu8+xZ595Zt3B8b1c0IhcE3n7SKeAzm1E+QGg3bI
            /Yom23fmJKIhzIeK71zJeyrdzvCF6szVgQvjB3so1NMxtesA6q6hd/uqwStDAShD
            vXzFG2dhz3lDC2YepZ+tLlzmIqdne1S3t1thnD+tA5qb7321y2ZpcqsBMvwLXK6f
            isWt1CBAJfhhaC/zRA6w6/HVXSCHDCSc4XNTiBHB1mgiH+/o/zdpHqu3omWePyzo
            5Pu82lECgYEA590j3Xk+VMS0SOQD3sRiN00udqgxPbCHaV+L5d9vlYsKtoIXIvs8
            tfdDktFyjQxu7SWKkAtk4Anypjje0JpfTfHBIYeupfr76kAJ/Wni2ZcMH+8nB81q
            qij0Bj5xp2VqkvXwmpYwec9lvMcZeFFCmld3cYe0Gi3HYrgkvycRNusCgYEA1lwW
            Q4Wo+ua+4mrxfUBhwUYIMb7nq0cHduQt6/rt6I3M3q3sPQDEMRUFw+fCaJRyk9Oi
            Z28E12SKVG/VuZ1FRd7p9xcIO8M+eTjq13hUfdeQwRZqu5PiIGSsj/HFVUI60SfS
            Vuc8moOZ3aZSYiVw+374gVE6+IPfNLg9su0zSgUCgYB0is3VK3TuDLUFkj5zwUgQ
            veWl1KJzfICDsXfTAjzG8M1gsQDKH3gDipZXfJlUVjSHVIBSKLf6eGWTsTAlsAJJ
            XkOSA+4AFah7tNaQnqFcdzSr9Hwsys5bWxxU6xwbZLltxtq6CNWy1FEx0u11cXrF
            s0MhOHGJWwtGDoLB5fQcIwKBgGI9M8rgL7BFHchAgMoJPoPIJ6s8tYmudMJNEqqq
            hmvkyLZo+PKALmncG5dL2LH7DoOnIy/KFmrsXeUSl92IMR4zagBeotxYv4Hozt/O
            +tHtgB6tul6bCLAV02vovqozPydp26EOOp0JoPOO7QSj6iKobxU8+Ay6ywmrQkOF
            J9NNAoGAezuidwONQplwJEqwP8nb7CHs7F/psKqBGnLjQ2If7D2fiU9KoR4BITYZ
            uAjwS2624w3PYXKUSMdy/q5s22wQ2JCcqXpdsnJCBQ39jsDXKar7H3zeXjAnBjmZ
            Ihv2d4kQUY2fdnsYNE7Mmi8hzGuEtoSkpmHNzVI1IWMeoXDBnZ0=
            -----END RSA PRIVATE KEY-----

cycloid_initial_service_catalog:
    name: Cycloid stacks
    url: git@github.com:cycloid-community-catalog/public-stacks.git
    branch: master

cycloid_db_password: "chovoh6gahti5ohP0AiF6eex6evoonie"
# cycloid_db_host: cycloid-db
# Get the address of the first defined host in cycloid-db group
cycloid_db_host: "{{ hostvars[groups['cycloid-db'][0]]['ansible_default_ipv4']['address'] }}"

cycloid_db_port: 3306
cycloid_db_user: cycloid
cycloid_db_name: cycloid
cycloid_db_path: "{{ cycloid_install_path }}/cycloid-db"

cycloid_email_smtp_svr_addr: "{{ hostvars[groups['smtp-server'][0]]['ansible_default_ipv4']['address'] }}:1025"
# The following example will rely on a smtp server installed locally on the host
#cycloid_email_smtp_svr_addr: "{{ ansible_docker0['ipv4']['address'] }}:25"

cycloid_email_insecure: true
cycloid_email_smtp_username: admin
cycloid_email_smtp_password: admin
cycloid_email_addr_from: noreply@cycloid.io
cycloid_email_addr_return_path: admin+ydbounce@cycloid.io
cycloid_email_redis_host: "{{ hostvars[groups['cycloid-redis'][0]]['ansible_default_ipv4']['address'] }}"
cycloid_email_redis_port: 6379
cycloid_email_redis_db: 0
cycloid_jwt_key_1: 2f2122de-63f2-4eec-9c6f-c6abb3e1f007:7cdyHps2tYDp6e7VKPEstE5sDMQbK6WLyN3GmTsF7x7QpE6ZP5ra6yfVSkvXakbB
cycloid_crypto_signing_key: totally-random-secret-key

# iam credential to get ecr images
cycloid_ecr_access_key: "{{ lookup('env','AWS_ACCESS_KEY_ID') | default(omit)}}"
cycloid_ecr_secret_key: "{{ lookup('env','AWS_SECRET_ACCESS_KEY') | default(omit)}}"

cycloid_api_container_links: []
concourse_web_container_links: []

cycloid_api_dns: cycloid-api
cycloid_use_api_via_console: True
cycloid_console_dns: cycloid-console
cycloid_frontend_base_url: "https://{{ cycloid_console_dns }}"

# Internal parameter that you need to specify if you want to use the staging version
#cycloid_api_replace_pattern_url: https://http-api-staging.cycloid.io
cycloid_api_replace_pattern_url: ""

#
# minio
#

#. minio_version(optional, string): "latest"
#+ docker tag image to use, default latest
minio_version: latest

#. minio_port(optional, int): 9000
#+ MinIO port, default to 9000
minio_port: 9000

#. minio_access_key(required): str
#+ the aws-like access key
minio_access_key: AKIAIOSFODNN7EXAMPLE

#. minio_secret_key(required): str
#+ the aws-like secret key
minio_secret_key: wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY

#. minio_browser(optional, string): off
#+ uncomment to enable browser interface
# minio_browser: on
